---
title: "Final Report"
author: "Isabel Siebrecht, Franklin Feng, & Kaylin Hernandez"
date: "11/16/21"
output:
  pdf_document: default
  html_document:
    df_print: paged
subtitle: 'due November 16, 2021 by 11:59 PM '
---

```{r load-packages, echo = FALSE, error = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(infer)
library(tidymodels)
install.packages("ggpubr")
library("ggpubr")

knitr::opts_chunk$set(eval = TRUE, echo = FALSE, message = FALSE, warning = FALSE)
``` 

```{r load-data, echo=FALSE}
hdi1 <- read.csv("../data/HDI_Table1.csv")
hdi4 <- read.csv("../data/HDI_Table4.csv")
hdi5 <- read.csv("../data/HDI_Table5.csv")
hdi8 <- read.csv("../data/HDI_Table8.csv")
hdi10 <- read.csv("../data/HDI_Table10.csv")
adolescent_births <- read.csv("../data/Adolescent_Births.csv")
contraceptive_prevalence <- read.csv("../data/Contraceptive_Prevalence.csv")
```


```{r clean-data, echo=FALSE}
hdi1_clean <- slice(hdi1, -c(1:7, 74, 128, 166, 200, 207:270))
hdi1_clean <- select(hdi1_clean, select = -c(X.1, X.3, X.5, X.7, X.9, X.11))
names(hdi1_clean) <- c("HDI Rank", "Country", "HDI 2019", "Life Expectancy Birth", "Expected Years Schooling", "Mean Years Schooling", "GNI Per Capita", "GNI Per Capita Minus HDI", "HDI 2018")

hdi4_clean <- slice(hdi4, -c(1:7, 74, 128, 166, 200, 207:264))
hdi4_clean <- select(hdi4_clean, select = -c(X.1, X.3, X.5, X.7, X.9, X.11, X.13, X.15, X.17, X.19, X.21, X.23))
names(hdi4_clean) <- c("HDI Rank", "Country", "Gender Development Index", "Gender Development Index Group", "HDI Female", "HDI Male", "Life Expectancy Birth Female", "Life Expectancy Birth Male", "Expected Years Schooling Female", "Expected Years Schooling Male", "Mean Years Schooling Female", "Mean Years Schooling Male", "Estimated GNI per Capita Female", "Estimated GNI per Capita Male")

hdi5_clean <- slice(hdi5, -c(1:7, 74, 128, 166, 200, 207:270))
hdi5_clean <- select(hdi5_clean, select = -c(X.1, X.3, X.5, X.7, X.9, X.11, X.13, X.15, X.17))
names(hdi5_clean) <- c("HDI Rank", "Country", "Gender Inequality Index", "Gender Inequality Index Rank", "Maternal Mortality Ratio", "Adolescent Birth Rate", "Seats Parliament Female", "Secondary Education Female", "Secondary Education Male", "Labour Participation Female", "Labour Participation Male")

hdi8_clean <- slice(hdi8, -c(1:7, 74, 128, 166, 200, 207:264))
hdi8_clean <- select(hdi8_clean, select = -c(X.1, X.3, X.5, X.7, X.9, X.11, X.13, X.15, X.17, X.19, X.21, X.23, X.25, X.27, X.29 : X.33))
names(hdi8_clean) <- c("HDI Rank", "Country", "Infants Breastfed", "Lack DTP Immunization", "Lack Measles Immunization", "Child Malnutrition", "Mortality Rate Infant", "Mortality Rate Under 5", "Mortality Rate Female", "Mortality Rate Male", "Mortality Rate Noncommunicable Female", "Mortality Rate Noncommunicable Male", "Malaria Incidence", "TB Incidence", "HIV Prevalence", "Healthy Life Expectancy at Birth", "Health Expenditure of GDP")

hdi10_clean <- slice(hdi10, -c(1:7, 74, 128, 166, 200, 207:260))
hdi10_clean <- select(hdi10_clean, select = -c(X.1, X.3, X.5, X.7, X.9, X.11, X.13, X.15, X.17, X.19, X.21, X.23))
names(hdi10_clean) <- c("HDI Rank", "Country", "GDP", "GDP per Capita", "GDP Annual Growth", "Labour Share", "Gross Fixed Capital Formation of GDP", "General Government Consumption of GDP", "General Government Consumption Annual Growth", "Total Tax Revenue of GDP", "Taxes Income Profits Capital Gains of TTR", "External Debt Stock of GNI", "Total Debt Service of GNI", "Consumer Price Index")

adolescent_births_clean <- select(adolescent_births, select = c(ParentLocation, Location, Period, IsLatestYear, FactValueNumeric, Value))
names(adolescent_births_clean) <- c("World Region", "Country", "Period", "Is Latest Year", "Adolescent Births", "Adolescent Births Text")

contraceptive_prevalence_clean <- slice(contraceptive_prevalence, -c(1:8))
contraceptive_prevalence_clean <- select(contraceptive_prevalence_clean, select = c(X, X.2, X.3, X.4, X.5, X.6, X.19))
names(contraceptive_prevalence_clean) <- c("Country", "Survey Start Year", "Survey End Year", "Age Group", "Contraceptive Any Method", "Contraceptive Modern Method", "Contraceptive Traditional Method")
```

```{r join-datasets, echo=FALSE}

country_joined <- hdi1_clean %>%
  inner_join(hdi10_clean, by = "Country")%>%
  inner_join(hdi4_clean, by = "Country")%>%
  inner_join(hdi5_clean, by = "Country")%>%
  inner_join(hdi8_clean, by = "Country")

contraceptives_joined <- contraceptive_prevalence_clean %>%
  inner_join(adolescent_births_clean, by = "Country")
```

## Introduction
Our group chose to research what influences the rates of teenage pregnancies because we consider premature pregnancies one of the most significant indicators of a country’s development and prosperity. Considering the repercussions of lost economic contributions and increased dependency on costly public programs [https://www.ncbi.nlm.nih.gov/books/NBK219229/], we hope our findings can encourage governments to reduce the rate of teenage pregnancies by focusing on the strongest predictor variables we identify in this report.  

In essence, we attempt to answer how a country’s quality of life, measured by human and economic resources, correlates to the birth rates for teenagers aged 15 to 19 years old. To answer our question, our explanatory variables of adolescent pregnancy rates are female educational attainment, GDP annual growth rate, life expectancy at birth, HDI, labor force participation rate, and gender inequality index.  
Information provided by Youth.gov supports our predictors because they broadly encompass the individual, family, and community that influence teenage pregnancies [https://youth.gov/youth-topics/pregnancy-prevention/risk-and-protective-factors].  

We pulled our data on adolescent birth rate from the World Health Organization who collected the results via various national and international surveys and country reports. We also pulled data from the 2020 Human Development Report provided by the United Nations. This data consisted of female educational attainment (number of years of schooling), GDP, life expectancy at birth, HDI, labor force participation rate, and gender inequality index. The gender equality index measures the gender disparity in a country on a scale from 0 to 1. The greater the value, the greater the measure of inequality.  

As a disclaimer, we acknowledge that our findings are based on preconceived, Western assumptions of what qualifies as a global indicator of “status.” Thus, we conducted this report on our assumptions of what defines a country’s prosperity and development.  

## Methodology

## Intro to data
For context purposes, we found data on 195 countries from the year 2019, and this is what the density plot for adolescent birth rate in our sample looks like. Additionally, throughout the report, adolescent birth rate is measured as the number of births per 1000 women aged 15-19 years old in a given population.
```{r total-rate, fig.height=3, fig.width=7, echo=FALSE}
country_joined %>%
  ggplot(aes(x= as.numeric(`Adolescent Birth Rate`))) +
  geom_boxplot() +
  labs(title= "International Adolsecent Birth Rates, 2019",
       x= "Adolescent Birth Rate (per 1,000 women aged 15-19)")

```
We see that the middle 50% of countries have a teenage birth rate between 39.1 and 70.5. Considering a high birth rate is 40-50 births per 1,000 women, our box plot shows a distribution of relatively high rates. We also have a few outlines, which are Chad (161.1), Mali (169.1), and Niger (186.5). All three have HDI ranks 187, 184, and 189, respectively.
```{r quantile, echo=FALSE}
quantile(as.numeric(country_joined$`Adolescent Birth Rate`), c(0, 0.25, 0.50, 0.75, 1))

#We need to fix this above since it will not let us knit! ^^^^^^^^^^^^^
```

## Relationships
After looking at the distribution of birth rate data, we decided to visually see if there was a relationship between our chosen factors and adolescent pregnancy rates. Therefore, we plotted our six explanatory variables (maternal mortality rate, female educational attainment, GDP, life expectancy, 2019 HDI, and Gender Development Index) onto separate scatter plots.  

**Is maternal mortality ratio related to adolescent birth rate?**
```{r maternal-mortality, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE, fig.height=3, fig.width=7}
ggplot(country_joined, aes(x = as.numeric(`Maternal Mortality Ratio`), 
                           y = as.numeric(`Adolescent Birth Rate`))) +
  geom_point(alpha=0.6) +
  labs(title= "Is Maternal Mortality Ratio Related to Adolescent Birth Rate",
       x = "Maternal Mortality Ratio", y = "Adolescent Birth Rate")

```
```{r cor-maternal-mortality, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`Maternal Mortality Ratio`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```

This data shows a positive, linear trend, and we see that as maternal mortality increases, so does adolescent birth rate across countries in 2019. The maternal mortality ratio signifies the number of maternal deaths per 100,000 live births during the same time. This trend makes sense because we expect countries with high adolescent birth rates to have high maternal mortality ratios. After all, the women are not physically capable of giving birth at that young of an age. The relationship between the two variables is positive and strong, considering its correlation coefficient is 0.7296. We can add this to our linear regression, which we will conduct later in this report to test which variables have the most substantial influence over adolescent birth rates.  

**Is female educational attainment related to adolescent birth rate?**
```{r fem-education, fig.height=3, fig.width=7, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}}
country_joined %>%
  ggplot(aes(x= as.numeric(`Expected Years Schooling Female`), 
             y= as.numeric(`Adolescent Birth Rate`))) +
  geom_point(alpha=0.6) +
  labs(
    title= "Is Female Educational Attainment Related to Adolescent Birth Rate?",
    x="Expected Years Schooling for Women",
    y="Adolescent Birth Rate"
  )
```
```{r cor-female-schooling, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`Expected Years Schooling Female`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
This graph highlights a strong, negative, linear trend (r= -0.7279) that as the expected years of schooling for women increases, the rate of adolescent births decreases (in 2019). This makes sense because the longer women stay in school, the less likely they will have children, considering the amount of time and effort it takes to raise a child. Thus, we can also add female educational attainment to our linear regression.  

**Is GDP Annual growth rate related to adolescent birth rate?**
```{r GDP, echo=FALSE, error=FALSE, fig.height=3, fig.width=7, message=FALSE, warning=FALSE}
ggplot(country_joined, aes(x = as.numeric(`GDP Annual Growth`), 
                           y = as.numeric(`Adolescent Birth Rate`), 
                           color = as.numeric(`HDI Rank.x`))) +
  geom_point() +
  geom_smooth() +
  labs(
    title= "Is GDP Annual Growth Rate Related to Adolescent Birth Rates?",
    x="GDP Annual Growth Rate",
    y="Adolescent Birth Rate",
    color = "HDI Rank") 
```
```{r cor-GDP, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`GDP Annual Growth`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
GDP, also known as Gross Domestic Product, annual growth rate signifies the annual average rate of change of the GDP at market prices based on constant local currency, for a given national economy, during a specified time. This graph shows an unclear relationship between GDP annual growth rate and adolescent birth rate (per 1,000 15-19-year-olds)--on neither the regular or log scale. This was surprising to see because we assumed countries with lower GDP annual growths would have higher adolescent birth rates. To double-check, we calculated the correlation coefficient and found a very weak, negative relationship (-0.1589). However, because there is still a slight correlation and we need an economic variable to compare, we will still include GDP annual growth in our linear regression.    

**Is life expectancy at birth related to adolescent birth rate?**
```{r life-exp, fig.height=3, fig.width=7, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}
ggplot(country_joined, aes(x = as.numeric(`Life Expectancy Birth`), 
                           y = as.numeric(`Adolescent Birth Rate`))) +
  geom_point(alpha=0.6)+
  labs(
    title= "Is Life Expectacy at Birth Related to Adolescent Birth Rate?",
    x="Life Expectacy at Birth",
    y="Adolescent Birth Rate"
  )

```
```{r cor-life-exp, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`Life Expectancy Birth`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
This graph shows a strong, negative, linear relationship (r=-0.7898) between life expectancy at birth and adolescent birth rate (per 1,000 women aged 15-19 years old), meaning as life expectancy increases, teenage birth rate decreases. This makes sense because women would have less need to reproduce if their children are expected to live for a long time. Thus, we will include life expectancy at birth in our linear regression model.    

**Is HDI in 2019 related to adolescent birth rate?**
```{r HDI, fig.height=3, fig.width=7, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}
country_joined %>%
  ggplot(aes(x= as.numeric(`HDI 2019`), 
             y= as.numeric(`Adolescent Birth Rate`))) +
  geom_point(alpha=0.6) +
  labs(
    title= "Is HDI in 2019 Related to Adolescent Birth Rate?",
    x="2019 HDI",
    y="Adolescent Birth Rate"
  )
```
```{r cor-HDI-2019, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`HDI 2019`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
HDI, also known as the Human Development Index, is a statistic used to rank countries. This plot shows a strong, negative, linear relationship (r=-0.794) between 2019 HDI and adolescent birth rate (per 1,000 women aged 15-19 years old), meaning as the HDI increases, the rate of adolescent birth rates decrease. This relationship makes sense because ___. Thus, we will include 2019 HDI in our regression.  

**Is labor force participation rate related to adolescent birth rate?**
```{r labor-force, fig.height=3, fig.width=7, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}
country_joined %>%
  ggplot(aes(x= as.numeric(`Labour Participation Female`), 
             y= as.numeric(`Adolescent Birth Rate`)))+
  geom_point(alpha=0.5) +
  labs(
    title= "Is Female Labor Participation Related to Adolescent Birth Rate?",
    x="Female Labor Participation",
    y="Adolescent Birth Rate"
  )
```
```{r cor-labor-participation, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`Labour Participation Female`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
From the plot, we only somewhat see a relationship between female labor participation and adolescent birth rate, and our correlation coefficient of 0.303 confirms a weak, positive linear correlation. Roughly, as female labor participation increases, the birth rate per 1,000 women aged 15-19 years old also increases. This is slightly surprising because we predicted that countries with high teenage birth rates would have higher female labor participation levels. We assumed the young women would be at home, mainly because we saw this earlier with female educational attainment. We will also include this variable in our regression.

**Is the gender develop index related to adolescent birth rate?**
```{r gender-inequality, fig.height=3, fig.width=7, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}
country_joined %>%
  ggplot(aes(x= as.numeric(`Gender Development Index`), 
             y= as.numeric(`Adolescent Birth Rate`))) +
  geom_point(alpha=0.6) +
  labs(
    title= "Is Gender Development Index Related to Adolescent Birth Rate?",
    x="Gender Development Index",
    y="Adolescent Birth Rate"
  )
```
```{r cor-GDI, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}

cor(as.numeric(country_joined$`Gender Development Index`), 
    as.numeric(country_joined$`Adolescent Birth Rate`), method = "pearson", use="complete.obs")

```
The gender development index measures gender inequality through gender-based gaps in education, life expectancy, and incomes, and the closer the value is to 1, the more equal a society is. We see that as the gender development index approaches 1, there is a slight linear decrease (r= -0.4846) in adolescent birth rate (per 1,000 15-19-year-olds). This relationship makes sense because we assume that more equal societies would allow women to make their own reproductive choices. They are also more likely to have resources and healthcare options for women. Thus, we will include this variable in our linear regression analysis.  

# Linear regression
**Which variable has the strongest correlation to adolescent birth rate?**
```{r total-linear-regression}
country_joined <- country_joined %>%
  filter(!`GDP` == "..") %>%
  filter(!`Adolescent Birth Rate` == "..") %>%
  filter(!`Maternal Mortality Ratio` == "..") %>%
  filter(!`Mean Years Schooling Female` == "..") %>%
  filter(!`Labour Participation Female` == "..") %>%
  filter(!`Gender Inequality Index` == "..") %>%
  mutate(GDP = as.numeric(`GDP`)) %>%
  mutate(Adolescent_Birth_Rate = as.numeric(`Adolescent Birth Rate`)) %>%
  mutate(Country_new = as.factor(`Country`)) %>%
  mutate(`Maternal Mortality Ratio` = str_replace(`Maternal Mortality Ratio`, ",", "")) %>%
  mutate(Maternal_Mortality_Ratio = as.numeric(`Maternal Mortality Ratio`)) %>%
  mutate(Mean_Years_Schooling_Female = as.numeric(`Mean Years Schooling Female`)) %>%
  mutate(Life_Expectancy_Birth = as.numeric(`Life Expectancy Birth`)) %>%
  mutate(HDI_2019 = as.numeric(`HDI 2019`)) %>%
  mutate(Labour_Participation_Female = as.numeric(`Labour Participation Female`)) %>%
  mutate(Gender_Inequality_Index = as.numeric(`Gender Inequality Index`))

linreg_total <- country_joined %>%
  select(Country_new, Adolescent_Birth_Rate, GDP, Maternal_Mortality_Ratio, Mean_Years_Schooling_Female, Life_Expectancy_Birth, HDI_2019, Labour_Participation_Female, Gender_Inequality_Index)
         
mainfit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Adolescent_Birth_Rate ~ GDP + Maternal_Mortality_Ratio + Mean_Years_Schooling_Female + Life_Expectancy_Birth + HDI_2019 + Labour_Participation_Female + Gender_Inequality_Index , data = linreg_total)
tidy(mainfit)

#Country_new is available to be added, but produces N/A values

#The 2 most statistically significant variables are Labour Participation Female and Gender Inequality Index. Both fall under the p = 0.05 range
```


```{r GDP-linreg}
country_joined <- country_joined %>%
  filter(!`GDP` == "..") %>%
  filter(!`Adolescent Birth Rate` == "..") %>%
  #filter(!`GNI Per Capita` == "..") %>%
  filter(!`GDP per Capita` == "..") %>%
  mutate(GDP = as.numeric(`GDP`)) %>%
  mutate(Adolescent_Birth_Rate = as.numeric(`Adolescent Birth Rate`)) %>%
  mutate(HDI_Rank = as.factor(`HDI Rank.x`)) %>%
  #mutate(GNI_Per_Capita = as.numeric(`GNI per Capita`)) %>%
  mutate(`GDP per Capita` = str_replace(`GDP per Capita`, ",", "")) %>%
  mutate(GDP_Per_Capita = as.numeric(`GDP per Capita`))
  

gdp_linreg <- country_joined %>%
  select(Adolescent_Birth_Rate, GDP, HDI_Rank, GDP_Per_Capita)
         
mainfit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Adolescent_Birth_Rate ~ GDP + HDI_Rank + GDP_Per_Capita, data = gdp_linreg)
tidy(mainfit)
```

```{r HDI Grouping}
country_joined %>%
  mutate(HDI_final = as.numeric(`HDI Rank.x`)) %>%
  mutate(gdp_linreg = cut(
    HDI_final,
    breaks = c(-Inf, 66, 119, 156, 189, Inf),
    labels = c(
      "Very High", "High", "Medium", "Low", "Other"
    )
    # labels = c(
    #   "Very High Human Development",
    #   "High Human Development",
    #   "Medium Human Development",
    #   "Low Human Development",
    #   "Other Human Development",
    # ),
    # right = TRUE
  ))
```

## Chi Squared Test
```{r}
chisq_test(country_joined, as.numeric(`Labour Participation Female`) ~ as.nummeric(`Adolescent_Birth_Rate`))

chisq_test(country_joined, as.numeric(`Gender Inequality Index`) ~ as.nummeric(`Adolescent_Birth_Rate`))

```

Ho: Β1 = 0, There is no correlation between Labour Participation Female and teenage birthrate. 
Ha: Β1 ≠ 0, There is a correlation between Labour Participation Female and teenage birthrate. 

Ho: Β1 = 0, There is no correlation between Gender Inequality Index and teenage birthrate. 
Ha: Β1 ≠ 0, There is a correlation between Gender Inequality Index and teenage birthrate.


## Summary & Next Steps

